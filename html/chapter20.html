<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>é™„å½• Aï¼šHarmony æ ¼å¼ä¸å¤šæ¨¡æ€æ¶ˆæ¯åè®®æ ‡å‡† (Appendix A)</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">åŸºäºå¤šæ¨¡æ€ç†è§£ç”Ÿæˆæ¨¡å‹çš„æ™ºèƒ½ä½“æ„å»ºæ•™ç¨‹ï¼ˆç›®å½•ï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 1 ç«  å¤šæ¨¡æ€æ™ºèƒ½ä½“æ¦‚è§ˆ (Chapter 1: Overview of Multimodal Agents)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 2 ç«  å¤šæ¨¡æ€è¾“å…¥è¾“å‡ºä¸ä¸Šä¸‹æ–‡ç®¡ç† (Multimodal I/O & Context)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 3 ç«  Tool Callï¼šå·¥å…·è°ƒç”¨è®¾è®¡ä¸ç¼–æ’</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 4 ç«  Agent Loopï¼šè§„åˆ’-æ‰§è¡Œ-åæ€çš„é—­ç¯</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 5 ç«  è®°å¿†ä¸çŸ¥è¯†ï¼šRAGã€å¤šæ¨¡æ€æ£€ç´¢ä¸çŠ¶æ€ç®¡ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 6 ç«  Agent Handoffï¼šä»»åŠ¡ç§»äº¤ä¸åä½œåè®®</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 7 ç«  OpenAI Harmony æ ¼å¼ä¸å¤šæ¨¡æ€æ¶ˆæ¯åè®®</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 8 ç«  Multi-Agentï¼šä»å•ä½“åˆ°ç¾¤ä½“åä½œ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 9 ç«  ä¸ä»¿çœŸç³»ç»Ÿäº’åŠ¨ï¼šé—­ç¯ã€é‡‡æ ·ä¸å®‰å…¨</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 10 ç«  Trace æ„é€ ã€è’¸é¦ä¸ Benchmark è¯„æµ‹ä½“ç³»</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 11 ç«  DeepResearch æ™ºèƒ½ä½“ï¼šå¤šæ¨¡æ€ç ”ç©¶ä¸é•¿æ–‡æ¡£ PDF</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 12 ç«  Coding Agentï¼šä»ä»“åº“ç†è§£åˆ°å¯åˆå¹¶ PR</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 13 ç«  è‡ªåŠ¨é©¾é©¶ VLA Agentï¼šä»æ„ŸçŸ¥åˆ°é—­ç¯å†³ç­–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 14 ç«  åº§èˆ±å¤šæ¨¡å¯¹è¯æœºå™¨äººï¼šå¯æ§ã€å¯é ã€å¯è§£é‡Š</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 15 ç«  GeoGuessr / åœ°ç†å®šä½ Agentï¼šä»ä¸€å¼ å›¾åˆ°ä¸€ä¸ªä¸–ç•Œåæ ‡</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter16.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 16 ç«  æœºå™¨äººæ“ä½œä¸å…·èº« VLA Agent</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter17.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 17 ç«  æ–‡æ¡£/ç¥¨æ®/è¡¨æ ¼å¤šæ¨¡ RPA Agentï¼šä¼ä¸šæµç¨‹è‡ªåŠ¨åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter18.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 18 ç«  ç”Ÿäº§çº§å·¥ç¨‹åŒ–ï¼šå¯è§‚æµ‹ã€å¯å›å½’ã€å¯è¿è¥ (Production-Grade Engineering)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter19.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 19 ç«  å®‰å…¨ã€å¯¹é½ä¸çº¢é˜Ÿï¼šæŠŠé£é™©å˜æˆå¯æµ‹è¯•é¡¹</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter20.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">é™„å½• Aï¼šHarmony æ ¼å¼ä¸å¤šæ¨¡æ€æ¶ˆæ¯åè®®æ ‡å‡† (Appendix A)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter21.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="aharmony-appendix-a">é™„å½• Aï¼šHarmony æ ¼å¼ä¸å¤šæ¨¡æ€æ¶ˆæ¯åè®®æ ‡å‡† (Appendix A)</h1>
<h2 id="1">1. åè®®è®¾è®¡å“²å­¦ä¸é€‚ç”¨èŒƒå›´</h2>
<p>æœ¬é™„å½•å®šä¹‰çš„ JSON ç»“æ„è¢«ç§°ä¸º <strong>"Harmony Schema"</strong>ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº OpenAI ChatCompletions API çš„è¶…é›†ï¼Œæ—¨åœ¨è§£å†³æ ‡å‡† API åœ¨å¤„ç†<strong>å¤æ‚å¤šæ¨¡æ€ã€å¤šæ™ºèƒ½ä½“åä½œã€ä»¥åŠé•¿é“¾è·¯çŠ¶æ€ç®¡ç†</strong>æ—¶çš„ä¸è¶³ã€‚</p>
<p><strong>è®¾è®¡åŸåˆ™ (Rule of Thumb):</strong></p>
<ol>
<li><strong>å•ä¸€äº‹å®æ¥æº (Single Source of Truth)</strong>ï¼šæ‰€æœ‰çš„æ„ŸçŸ¥ï¼ˆå›¾ç‰‡/éŸ³é¢‘ï¼‰ã€æ¨ç†ï¼ˆæ–‡æœ¬ï¼‰ã€è¡ŒåŠ¨ï¼ˆå·¥å…·è°ƒç”¨ï¼‰éƒ½å¿…é¡»åºåˆ—åŒ–ä¸º Message Listã€‚</li>
<li><strong>åŸå­åŒ– (Atomicity)</strong>ï¼šå¤šæ¨¡æ€å†…å®¹ï¼ˆContent Partsï¼‰å¿…é¡»ç‹¬ç«‹çš„ã€å¯å¯»å€çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å•çº¯çš„æ‹¼æ¥å­—ç¬¦ä¸²ã€‚</li>
<li><strong>æ— çŠ¶æ€æ€§ (Statelessness)</strong>ï¼šHandoff Packetï¼ˆç§»äº¤åŒ…ï¼‰å¿…é¡»åŒ…å«æ¥æ‰‹ä»»åŠ¡æ‰€éœ€çš„ä¸€åˆ‡ä¿¡æ¯ï¼Œæ¥æ”¶æ–¹æ— éœ€æŸ¥è¯¢ä¸Šä¸€è½® Agent çš„åŸå§‹æ—¥å¿—ã€‚</li>
</ol>
<hr />
<h2 id="2-a1-the-universal-message-object">2. A.1 é€šç”¨æ¶ˆæ¯ä½“ç»“æ„ (The Universal Message Object)</h2>
<p>è¿™æ˜¯ç³»ç»Ÿä¸­æµè½¬çš„æœ€å°æ•°æ®å•å…ƒã€‚</p>
<h3 id="a11">A.1.1 åŸºç¡€éª¨æ¶</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;msg_123456789&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1">// æ¶ˆæ¯å”¯ä¸€ IDï¼ˆç”¨äºå¼•ç”¨å’Œå›æ»šï¼‰</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user | assistant | system | tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ResearchAgent_01&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1">// [å¯é€‰] å‘è¨€è€…åç§°ï¼Œå¤š Agent åœºæ™¯å¿…å¡«</span>
<span class="w">  </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1715000000</span><span class="p">,</span><span class="w">       </span><span class="c1">// Unix æ—¶é—´æˆ³</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">],</span><span class="w">             </span><span class="c1">// è§ä¸‹æ–‡ Content Parts</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">}</span><span class="w">             </span><span class="c1">// è§ A.6 å…ƒæ•°æ®éƒ¨åˆ†</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="a12-content-parts">A.1.2 Content Partsï¼šå¤šæ¨¡æ€è½½è·è¯¦è§£</h3>
<p><code>content</code> å­—æ®µä¸å†æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚</p>
<h4 id="1-text-thought">(1) æ–‡æœ¬ä¸æ¨ç†é“¾ (Text &amp; Thought)</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;æ ¹æ®ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæˆ‘æµ‹åˆ°äº†æ˜æ˜¾çš„è£‚ç—•ã€‚&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2-image-url-base64">(2) å›¾åƒ (Image) - æ”¯æŒ URL ä¸ Base64</h4>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ URLï¼ˆé…åˆçŸ­æœŸç­¾åçš„ S3 é“¾æ¥ï¼‰ï¼ŒBase64 ä»…ç”¨äºè°ƒè¯•æˆ–æä½å»¶è¿Ÿçš„æœ¬åœ°äº¤äº’ã€‚</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://s3.amazonaws.com/bucket/invoice_scan_01.jpg&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;detail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// é€‰é¡¹: low (85 tokens), high (æŒ‰ tiles è®¡ç®—), auto</span>
<span class="w">    </span><span class="nt">&quot;rotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">     </span><span class="c1">// [æ‰©å±•] é¢„å¤„ç†æ—‹è½¬è§’åº¦ï¼Œé˜²æ­¢æ¨¡å‹çœ‹æ­ª</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="3-video-segment-">(3) è§†é¢‘ç‰‡æ®µ (Video Segment) - æŠ½å¸§åºåˆ—è¡¨ç¤º</h4>
<p>è§†é¢‘é€šå¸¸ä¸ç›´æ¥å‘ç»™æ¨¡å‹ï¼Œè€Œæ˜¯è½¬ä¸ºä¸€ç»„å¸¦æ—¶é—´æˆ³çš„å›¾ç‰‡å¸§ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;video_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">           </span><span class="c1">// [æ‰©å±•å­—æ®µ]</span>
<span class="w">    </span><span class="nt">&quot;video_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vid_abc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp_sec&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">12.5</span><span class="p">,</span><span class="w">      </span><span class="c1">// è¯¥å¸§åœ¨è§†é¢‘ä¸­çš„ç§’æ•°</span>
<span class="w">    </span><span class="nt">&quot;frame_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="4-input-audio">(4) éŸ³é¢‘è¾“å…¥ (Input Audio)</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;input_audio&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;input_audio&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;base64_string...&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// PCM åŸå§‹æ•°æ®æˆ–å‹ç¼©æ ¼å¼</span>
<span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wav&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sample_rate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">24000</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="3-a2-tool-invocation-protocol">3. A.2 å·¥å…·è°ƒç”¨åè®® (Tool Invocation Protocol)</h2>
<p>è¿™æ˜¯ Agent ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„<strong>ç‰©ç†å±‚</strong>ã€‚</p>
<h3 id="a21-assistant-message">A.2.1 æ¨¡å‹å‘èµ·çš„è°ƒç”¨ (Assistant Message)</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// æˆ–è€…æ˜¯ &quot;æˆ‘å°†ä¸ºæ‚¨æŸ¥è¯¢å¤©æ°”...&quot;</span>
<span class="w">  </span><span class="nt">&quot;tool_calls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;call_890xyz&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;search_knowledge_base&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;keywords\&quot;: [\&quot;Transformer architecture\&quot;, \&quot;Attention mechanism\&quot;], \&quot;year_filter\&quot;: 2023}&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="a22-tool-message">A.2.2 å·¥å…·æ‰§è¡Œç»“æœ (Tool Message)</h3>
<p><strong>å…³é”®è§„åˆ™</strong>ï¼š</p>
<ul>
<li><strong>1å¯¹1æ˜ å°„</strong>ï¼š<code>tool_calls</code> æ•°ç»„ä¸­æœ‰å‡ ä¸ªå…ƒç´ ï¼Œåç»­å°±å¿…é¡»ç´§è·Ÿå‡ ä¸ª <code>role: tool</code> çš„æ¶ˆæ¯ã€‚</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå¦‚æœå·¥å…·æŠ¥é”™ï¼Œ<strong>å¿…é¡»</strong>è¿”å› JSON æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä»¥ä¾¿æ¨¡å‹å†³å®šæ˜¯å¦é‡è¯•ã€‚</li>
</ul>
<h4 id="_1">æˆåŠŸå“åº”ï¼š</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tool_call_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;call_890xyz&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;search_knowledge_base&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;status\&quot;: \&quot;success\&quot;, \&quot;results\&quot;: [{\&quot;title\&quot;: \&quot;Attention is All You Need\&quot;, \&quot;snippet\&quot;: \&quot;...\&quot;}]}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="_2">å¤±è´¥å“åº”ï¼ˆè®©æ¨¡å‹è‡ªæˆ‘ä¿®å¤ï¼‰ï¼š</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tool_call_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;call_890xyz&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;status\&quot;: \&quot;error\&quot;, \&quot;error_type\&quot;: \&quot;InvalidDateRange\&quot;, \&quot;message\&quot;: \&quot;The year 2023 is in the future relative to the database snapshot (2022). Please try an earlier year.\&quot;}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="a23-advanced">A.2.3 å¤šæ¨¡æ€å·¥å…·è¿”å› (Advanced)</h3>
<p>æœ‰äº›å·¥å…·ï¼ˆå¦‚æµè§ˆå™¨æˆªå›¾ã€matplotlib ç»˜å›¾ï¼‰è¿”å›çš„æ˜¯å›¾ç‰‡ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tool_call_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;call_render_chart&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;status\&quot;: \&quot;rendered_successfully\&quot;}&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_url&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://.../chart_temp.png&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="4-a3-handoff-packet-schema">4. A.3 ä»»åŠ¡ç§»äº¤ä¸çŠ¶æ€åŒ… (Handoff Packet Schema)</h2>
<p>å½“æµç¨‹ä» "Planner Agent" è½¬ç§»åˆ° "Coder Agent" æ—¶ï¼Œä½¿ç”¨æ­¤ Schemaã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;harmony_handoff_v1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;source_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;planner_v2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target_agent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;coder_v1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-03-20T10:00:00Z&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. ä»»åŠ¡ç›®æ ‡ï¼ˆä¸å¯å˜ï¼‰</span>
<span class="w">    </span><span class="nt">&quot;primary_objective&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ä¸ºç”¨æˆ·æ„å»ºä¸€ä¸ª Python è´ªåƒè›‡æ¸¸æˆ&quot;</span><span class="p">,</span>

<span class="w">    </span><span class="c1">// 2. å½“å‰è¿›åº¦</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;in_progress&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completed_steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;éœ€æ±‚åˆ†æ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;æŠ€æœ¯é€‰å‹(Pygame)&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;next_immediate_step&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ç¼–å†™æ ¸å¿ƒæ¸¸æˆå¾ªç¯ä»£ç &quot;</span><span class="p">,</span>

<span class="w">    </span><span class="c1">// 3. å…³é”®çº¦æŸ (Memory)</span>
<span class="w">    </span><span class="nt">&quot;constraints&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;å¿…é¡»æœ‰è¯¦ç»†æ³¨é‡Š&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;èƒŒæ™¯é¢œè‰²è®¾ä¸ºé»‘è‰²&quot;</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="c1">// 4. å…±äº«èµ„äº§ (Artifacts) - é¿å…é‡å¤ä¸Šä¼ /ä¸‹è½½</span>
<span class="w">    </span><span class="nt">&quot;artifacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;design_doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://.../spec.md&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;assets_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./assets/&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="c1">// 5. [å¯é€‰] å‹ç¼©åçš„å¯¹è¯å†å²æ‘˜è¦</span>
<span class="w">  </span><span class="nt">&quot;history_summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ç”¨æˆ·æœ€åˆè¦æ±‚3Dæ¸¸æˆï¼Œç»åå•†ç¡®è®¤ä¸º2Dç‰ˆæœ¬...&quot;</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="5-a4-citation-grounding-schema">5. A.4 å¼•ç”¨ä¸è¯æ®é”šå®š (Citation &amp; Grounding Schema)</h2>
<p>ä¸ºå®ç°â€œå¯ä¿¡å›ç­”â€ï¼Œæ¯æ¡ç”Ÿæˆå†…å®¹éƒ½åº”å…³è”è¯æ®ã€‚è¿™é€šå¸¸å­˜å‚¨åœ¨æ¶ˆæ¯çš„ <code>metadata</code> æˆ–ä¸“é—¨çš„ <code>context_block</code> ä¸­ã€‚</p>
<h3 id="a41">A.4.1 è¯æ®å¯¹è±¡å®šä¹‰</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;citation_map&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;cit_01&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;source_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pdf_document&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;source_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc_fin_report_2023&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;source_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023_Financial_Report.pdf&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;page_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;bbox&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">],</span><span class="w"> </span><span class="c1">// [x1, y1, x2, y2] ç”¨äºå‰ç«¯åœ¨ PDF ä¸Šç”»æ¡†</span>
<span class="w">        </span><span class="nt">&quot;text_snippet&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Revenue increased by 20% YoY.&quot;</span><span class="w"> </span><span class="c1">// ç”¨äºæ ¡éªŒ</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.89</span><span class="w"> </span><span class="c1">// æ£€ç´¢ç›¸å…³æ€§åˆ†æ•°</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;cit_02&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;source_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;web_search&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://wikipedia.org/...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;access_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-03-20&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="a42-in-text-anchors">A.4.2 æ–‡æœ¬ä¸­çš„é”šç‚¹ (In-text Anchors)</h3>
<p>æ¨¡å‹è¾“å‡ºçš„æ–‡æœ¬åº”åŒ…å«å¦‚ä¸‹æ ‡è®°ï¼š</p>
<blockquote>
<p>"2023å¹´çš„è¥æ”¶å¢é•¿å¼ºåŠ² <strong><cite id="cit_01"/></strong>ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºäº‘æœåŠ¡å¸‚åœºçš„æ‰©å¼  <strong><cite id="cit_02"/></strong>ã€‚"</p>
</blockquote>
<hr />
<h2 id="6-a6-metadata-observability">6. A.6 å…ƒæ•°æ®ä¸å¯è§‚æ€§å­—æ®µ (Metadata &amp; Observability)</h2>
<p>ä¸ºäº†ç”Ÿäº§ç¯å¢ƒçš„è°ƒè¯•ï¼ˆTraceï¼‰å’Œè®¡è´¹ï¼Œæ¯æ¡æ¶ˆæ¯åº”æºå¸¦ä»¥ä¸‹éšå½¢ä¿¡æ¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// æˆæœ¬è¿½è¸ª</span>
<span class="w">  </span><span class="nt">&quot;token_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;prompt_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completion_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_cost_usd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.002</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// å»¶è¿Ÿè¿½è¸ª</span>
<span class="w">  </span><span class="nt">&quot;latency_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ttft&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">        </span><span class="c1">// Time to First Token</span>
<span class="w">    </span><span class="nt">&quot;total_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span>
<span class="w">  </span><span class="p">},</span>

<span class="w">  </span><span class="c1">// æ¨¡å‹æŒ‡çº¹</span>
<span class="w">  </span><span class="nt">&quot;model_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-4-vision-preview-2024-04-09&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;system_fingerprint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fp_12345&quot;</span><span class="p">,</span>

<span class="w">  </span><span class="c1">// ä¸šåŠ¡ä¸Šä¸‹æ–‡</span>
<span class="w">  </span><span class="nt">&quot;session_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess_user_999&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;trace_uuid_v4&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// å…³è”åˆ° Datadog/LangSmith</span>

<span class="w">  </span><span class="c1">// å®‰å…¨æ ‡è®°</span>
<span class="w">  </span><span class="nt">&quot;safety_check&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;flagged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="7">7. æœ¬ç« å°ç»“</h2>
<ul>
<li><strong>ç»“æ„åŒ–è‡³ä¸Š</strong>ï¼šæ°¸è¿œä¸è¦ä¾èµ–æ­£åˆ™è¡¨è¾¾å¼å»è§£æ Agent çš„è¾“å‡ºï¼Œå¿…é¡»å¼ºåˆ¶è¦æ±‚ JSON è¾“å‡ºæˆ– Tool Callã€‚</li>
<li><strong>ID æ˜¯ç”Ÿå‘½çº¿</strong>ï¼šåœ¨å¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨ä¸­ï¼Œ<code>tool_call_id</code> æ˜¯è¿æ¥ "æ€è€ƒ" ä¸ "ç»“æœ" çš„å”¯ä¸€çº½å¸¦ï¼Œä¸¢å¤± ID ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡é”™ä¹±ã€‚</li>
<li><strong>Handoff æ˜¾å¼åŒ–</strong>ï¼šåœ¨å¤š Agent åˆ‡æ¢æ—¶ï¼Œå¿…é¡»æ˜¾å¼ä¼ é€’ <code>constraints</code> å’Œ <code>artifacts</code>ï¼Œå¦åˆ™æ¥æ‰‹çš„ Agent ä¼šåƒå¤±å¿†ä¸€æ ·é‡å¤è¯¢é—®ç”¨æˆ·ã€‚</li>
</ul>
<hr />
<h2 id="8">8. ç»ƒä¹ é¢˜</h2>
<h3 id="1_1">ç»ƒä¹  1ï¼šæ„å»ºä¸€ä¸ªâ€œè§†é¢‘å¼‚å¸¸æ£€æµ‹â€çš„æ¶ˆæ¯è½½è·</h3>
<p><strong>åœºæ™¯</strong>ï¼šå®‰é˜²æ‘„åƒå¤´æ¯ç§’æˆªå–ä¸€å¸§ï¼ŒAgent éœ€è¦åˆ†æç¬¬ 10 ç§’åˆ°ç¬¬ 15 ç§’çš„ç”»é¢ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰äººå‘˜å…¥ä¾µã€‚
<strong>è¦æ±‚</strong>ï¼šä½¿ç”¨ <code>content parts</code> æ„é€  User Messageï¼ŒåŒ…å« 5 å¼ å…³é”®å¸§ï¼Œå¹¶é™„å¸¦æ—¶é—´æˆ³å…ƒæ•°æ®ã€‚</p>
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;è¯·åˆ†æä»¥ä¸‹ç›‘æ§ç”»é¢åºåˆ—ï¼ˆ10s-15sï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨æœªæˆæƒäººå‘˜è¿›å…¥ç¦åŒºã€‚&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ç¬¬ 10 ç§’å¸§</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://.../frame_10s.jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;detail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;video_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;timestamp_sec&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// è‡ªå®šä¹‰å­—æ®µï¼Œéœ€æ¨¡å‹æˆ–ä¸­é—´ä»¶æ”¯æŒè§£æ</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... é—´å¸§çœç•¥ ...</span>
<span class="w">    </span><span class="c1">// ç¬¬ 15 ç§’å¸§</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://.../frame_15s.jpg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;detail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;video_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;timestamp_sec&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.0</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><em>æç¤ºï¼šå¯¹äºå®‰é˜²åœºæ™¯ï¼Œé€šå¸¸è®¾ç½® detail: "low" ä»¥é™ä½å»¶è¿Ÿï¼Œé™¤ééœ€è¦è¯†åˆ«äººè„¸ç»†èŠ‚ã€‚</em></p>
</details>
<h3 id="2">ç»ƒä¹  2ï¼šè®¾è®¡ä¸€ä¸ªâ€œéœ€è¦ç”¨æˆ·ç¡®è®¤â€çš„å·¥å…·ä¸­æ–­åè®®</h3>
<p><strong>åœºæ™¯</strong>ï¼šAgent æƒ³è¦æ‰§è¡Œ <code>delete_database</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜å±æ“ä½œã€‚è®¾è®¡ä¸€ä¸ª Tool Call å“åº”ï¼Œæ—¢ä¸æ‰§è¡Œåˆ é™¤ï¼Œåˆå¼•å¯¼æ¨¡å‹å»è¯¢é—®ç”¨æˆ·ã€‚</p>
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>
<p><strong>æ€è·¯</strong>ï¼šå·¥å…·å±‚æ‹¦æˆªè¯¥è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„ Error æˆ– Infoï¼Œå‘Šè¯‰æ¨¡å‹â€œéœ€è¦ç¡®è®¤â€ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tool_call_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;call_delete_db_123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;status\&quot;: \&quot;halted\&quot;, \&quot;reason\&quot;: \&quot;human_confirmation_required\&quot;, \&quot;message\&quot;: \&quot;This is a high-risk operation. You MUST ask the user for explicit confirmation (type &#39;YES&#39;) before proceeding. Do not execute this tool again until confirmation is received.\&quot;}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><em>Agent æ”¶åˆ°æ­¤æ¶ˆæ¯åï¼Œä¼šè¾“å‡ºæ–‡æœ¬å‘ç”¨æˆ·æé—®ï¼Œä»è€Œå®ç° Human-in-the-loopã€‚</em></p>
</details>
<hr />
<h2 id="9-gotchas">9. å¸¸è§é™·é˜± (Gotchas)</h2>
<ol>
<li>
<p><strong>JSON åµŒå¥—åœ°ç‹±</strong>ï¼š
* <em>é”™è¯¯</em>ï¼šåœ¨ <code>tool_call</code> çš„ <code>arguments</code> é‡Œç›´æ¥æ”¾ JSON å¯¹è±¡ã€‚
* <em>æ­£ç¡®</em>ï¼š<code>arguments</code> <strong>å¿…é¡»æ˜¯ String</strong>ã€‚å³ <code>JSON.stringify(args_object)</code>ã€‚è¿™æ˜¯æœ€å¸¸è§çš„æ–°æ‰‹é”™è¯¯ï¼Œå¯¼è‡´ API 400 æŠ¥é”™ã€‚</p>
</li>
<li>
<p><strong>å›¾ç‰‡è¿‡æœŸ</strong>ï¼š
* å¦‚æœæ˜¯ä½¿ç”¨ä¸´æ—¶ç­¾åçš„ URLï¼ˆå¦‚ AWS S3 Presigned URLï¼‰ï¼Œé€šå¸¸æœ‰æ•ˆæœŸåªæœ‰ 15-60 åˆ†é’Ÿã€‚å¦‚æœç”¨æˆ·ç¬¬äºŒå¤©å›æ¥ç¿»çœ‹å†å²è®°å½•ï¼ŒAgent å¯èƒ½ä¼šå› ä¸ºé“¾æ¥å¤±æ•ˆè€ŒæŠ¥é”™ã€‚
* <em>å¯¹ç­–</em>ï¼šåœ¨åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰åšä¸€å±‚ä»£ç†ï¼Œæˆ–è€…åœ¨å­˜å…¥ Long-term Memory æ—¶å°†å›¾ç‰‡è½¬å­˜åˆ°æŒä¹…åŒ–å­˜å‚¨å¹¶æ›´æ–° URLã€‚</p>
</li>
<li>
<p><strong>Token æº¢å‡ºä¸æˆªæ–­</strong>ï¼š
* History List ä¸é™é•¿ï¼Œä½† Context Window æœ‰é™ã€‚
* <em>å¯¹ç­–</em>ï¼šä¸è¦ç›²ç›® <code>.append()</code>ã€‚å¿…é¡»å®ç°ä¸€ä¸ª <code>trim_messages(history, max_tokens)</code> å‡½æ•°ã€‚å¯¹äºå¤šæ¨¡æ€æ¶ˆæ¯ï¼Œè¦ç‰¹åˆ«æ³¨æ„ä¸€å¼  <code>detail: high</code> çš„å›¾ç‰‡å¯èƒ½å ç”¨ 1000+ tokensï¼Œæ¯”å‡ ç™¾è¡Œæ–‡å­—è¿˜å¤šã€‚ä¼˜å…ˆä¸¢å¼ƒæ—§çš„å›¾ç‰‡ï¼Œä¿ç•™æ—§çš„æ–‡æœ¬æ‘˜è¦ã€‚</p>
</li>
<li>
<p><strong>Audio/Video æ··æ·†</strong>ï¼š
* ç›®å‰çš„æ¨¡å‹é€šå¸¸ä¸æ”¯æŒç›´æ¥ä¸Šä¼  <code>.mp4</code> æ–‡ä»¶ã€‚ä½ å¿…é¡»åœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯é€šè¿‡ <code>ffmpeg</code> æŠ½å¸§ï¼ˆFrames Extractionï¼‰å¹¶æå–éŸ³è½¨ï¼ˆAudio Extractionï¼‰ï¼Œåˆ†åˆ«ä½œä¸º Image List å’Œ Audio Input ä¼ å…¥ã€‚ä¸è¦è¯•å›¾æŠŠäºŒè¿›åˆ¶æµç›´æ¥å¡è¿› Text å­—æ®µã€‚</p>
</li>
</ol>
            </article>
            
            <nav class="page-nav"><a href="chapter19.html" class="nav-link prev">â† ç¬¬ 19 ç«  å®‰å…¨ã€å¯¹é½ä¸çº¢é˜Ÿï¼šæŠŠé£é™©å˜æˆå¯æµ‹è¯•é¡¹</a><a href="chapter21.html" class="nav-link next">Untitled â†’</a></nav>
        </main>
    </div>
</body>
</html>